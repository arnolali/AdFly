var _g=globals={},app=app||{};app=function(e,t){var s=this;s.culture=e,s.root=t,s.step=1,s.offersNbr=0,$.getJSON(s.root+"public/data/translations.json",function(e){s.t=e,s.map_(),s.init_(),s.bindEvents_()}).error(function(){console.log("Erreur chargement des traduction!")})},app.prototype.map_=function(){var e=this;e.dom={b:$("body"),f:$(".js-form"),steps:$(".steps"),step1:$(".step.no1"),step2:$(".step.no2"),step3:$(".step.no3"),previousStep:$(".js-previousStep"),nextStep:$(".js-nextStep"),submit:$(".js-submit"),screenNbr:$('[name="screensNbr"]'),addScreen:$(".addScreen"),screensList:$(".screensList"),field:{noClient:$('[name="noClient"]'),noAd:$('[name="noAd"]'),category:$('[name="category"]'),date:$('[name="date"]'),formatRadio:$(".row.format input"),format:$(".row.format .radio")}},e.path={images:"public/images/",templates:"public/templates/"}},app.prototype.init_=function(){var e=this;e.validator=e.dom.f.validate({debug:!0,errorPlacement:function(e,t){e.appendTo(t.closest(".field").find(".lbl"))},highlight:function(e){$(e).closest(".field").addClass("error").removeClass("valid")},unhighlight:function(e){$(e).closest(".field").addClass("valid").removeClass("error")},rules:{noClient:{required:!0,minlength:6,maxlength:6},noAd:{minlength:7,maxlength:7},logo:{required:!0}},messages:{noClient:{required:' <span class="msg">('+e.t[e.culture].requiredField+")</span>",minlength:' <span class="msg">('+e.t[e.culture].mustContain6digits+")</span>",maxlength:' <span class="msg">('+e.t[e.culture].mustContain6digits+")</span>"},noAd:{minlength:' <span class="msg">('+e.t[e.culture].mustContain7digits+")</span>",maxlength:' <span class="msg">('+e.t[e.culture].mustContain7digits+")</span>"},logo:{required:' <span class="msg">('+e.t[e.culture].requiredField+")</span>"}}}),e.dom.field.noClient.mask("000000"),e.dom.field.noAd.mask("0000000"),e.dom.field.formatRadio.each(function(){var t=$(this),s=t.val();t.attr("checked")?(t.hide(),t.after($("<img src='"+e.path.images+"formats/"+s+".png' class='radio valid' />"))):(t.hide(),t.after($("<img src='"+e.path.images+"formats/"+s+".png' class='radio'  />")))}),e.verticalAlign_($(".step.no1 .content"))},app.prototype.bindEvents_=function(){var e=this;e.dom.addScreen.on("click",function(t){t.preventDefault(),e.offersNbr++,e.dom.screenNbr.val(e.i),e.addOffer_({id:e.offersNbr,t:e.t[e.culture]})}),e.dom.nextStep.on("click",function(){e.changeStep_(1)}),e.dom.previousStep.on("click",function(){e.changeStep_(-1)}),e.dom.submit.on("click",function(){}),e.dom.step1.on("click",".radio",function(){e.updateRadioFormat_($(this))}),e.dom.steps.on("change",".file-input",function(){e.updateInputFilePreview_($(this))})},app.prototype.changeStep_=function(e){var t=this,s=$(".step.no"+t.step),a=!0;if($(".js-validate",s).each(function(e,s){a=t.validator.element(s)&&a}),1==t.step&&a&&0==t.offersNbr){var r=t.setTemplateSettings_(t.dom.field.category.val(),$(".row.format input:checked").val());t.addOffer_({id:t.offersNbr,t:t.t[t.culture],opt:r})}a&&(t.step+=parseInt(e),t.dom.b.removeClass("no1 no2 no3").addClass("no"+t.step))},app.prototype.setTemplateSettings_=function(e,t){var s={price:!0,date:!1,maxOffers:2};return"conferences"==e&&(s.price=!1,s.date=!0),"324x480"==t?s.maxOffers=4:"230x324"==t&&(s.maxOffers=1),s},app.prototype.updateInputFilePreview_=function(e){var t=this;t.getUploadedImageObj_(e,function(t){var s=e.closest(".btn"),a=s.closest(".field"),r=(a.find(".lbl"),s.next(".preview"));r.css({"background-image":"url("+t+")"}).addClass("active"),e.blur()})},app.prototype.getUploadedImageObj_=function(e,t){var s=e.prop("files")[0],a=new FileReader;a.onload=function(e){$("<img/>").attr("src",e.target.result).load(function(){var s=e.target.result;t(s)})},a.readAsDataURL(s)},app.prototype.updateRadioFormat_=function(e){e.parent().find(".valid").removeClass("valid").prev().removeAttr("checked"),e.addClass("valid").prev().attr("checked","true")},app.prototype.addOffer_=function(e){var t=this;$.get(t.path.templates+"screen-tpl.mustache.html",function(s){t.dom.screensList.append(Mustache.render($(s).filter("#screenTpl").html(),e)),$("input[name='"+e.id+"_destination']").rules("add",{required:!0,messages:{required:' <span class="msg">('+t.t[t.culture].requiredField+")"}}),$("input[name='"+e.id+"_moreDestination']").rules("add",{required:!0,messages:{required:' <span class="msg">('+t.t[t.culture].requiredField+")"}}),1==e.opt.price&&t.dom.f.find("input[name='"+e.id+"_price']").rules("add",{required:!0,messages:{required:' <span class="msg">('+t.t[t.culture].requiredField+")"}}),$("input[name='"+e.id+"_price']").mask("99999"),$("input[name='"+e.id+"_link']").rules("add",{required:!0,url:!0,messages:{required:' <span class="msg">('+t.t[t.culture].requiredField+")",url:' <span class="msg">('+t.t[t.culture].enterValidURL+")"}}),$("input[name='"+e.id+"_picture']").rules("add",{required:!0,messages:{required:' <span class="msg">('+t.t[t.culture].requiredField+")"}}),$("input[name='"+e.id+"_description']").rules("add",{required:!0,messages:{required:' <span class="msg">('+t.t[t.culture].requiredField+")"}})})},app.prototype.verticalAlign_=function(e){var t=e.height(),s=$(window).height(),a=(s-t-90)/2;e.css("top",a+"px")};